{% extends 'nav.html.twig' %}

{% block title %}Affaires{% endblock %}


{% block javascripts %}


{% endblock %}

 {% block stylesheets %}

     <link rel="stylesheet" href="{{ asset('/assets/css/datatables/buttons.dataTables.css') }}" />
     <link rel="stylesheet" href="{{ asset('/assets/css/datatables/buttons.bootstrap5.css') }}" />

     <style>
         .dt-buttons{
             margin-bottom: 1em!important;
             margin-left: 0.5em!important;
         }
         #tab-content{
             display: none;
         }
         #loader{
             display: block;
         }
         #loading {
             background: url('{{ asset('/assets/img/loader.gif') }}') no-repeat center center;
             position: absolute;
             top: 0;
             left: 0;
             height: 100%;
             width: 100%;
             z-index: 9999999;
         }
         .pagination .page-item .page-link{
             color: white!important;
         }
     </style>
 {% endblock %}


{% block content %}




    <div style="margin-top: 1em; ">


        {% if entite is not null %}

            <!-- Modal entite -->
            <div class="modal fade" id="entiteModal" tabindex="-1" role="dialog" aria-labelledby="entiteModal" aria-hidden="true" data-backdrop="static" data-keyboard="false">

                <div class="modal-dialog modal-lg modal-notify modal-info modal-dialog-scrollable" role="document">
                    <!--Content-->
                    <div class="modal-content">
                        <!--Header-->
                        <div class="modal-header">
                            <p class="heading lead">Entite</p>

                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true" class="white-text">Ã—</span>
                            </button>
                        </div>

                        <!--Body-->
                        <div class="modal-body">

                            <div class="text-left">
                                <!-- <i class="fas fa-window-close fa-4x mb-3 animated rotateIn"></i> -->

                                <div class="mb-2">
                                    <span class="font-weight-bold">Nom et prenoms / Description : </span>
                                    <span>{{ entite.description }} &nbsp {{ entite.description2 }}</span>
                                </div>

                                <div class="mb-2">
                                    <span class="font-weight-bold">Numero de : </span>
                                    <span>{{ entite.description }} &nbsp {{ entite.description2 }}</span>
                                </div>



                            </div>

                        </div>

                        <!--Footer-->
                        <div class="modal-footer">
                            <a type="button" class="btn btn-outline-info waves-effect" data-dismiss="modal">Fermer</a>
                        </div>
                    </div>
                    <!--/.Content-->
                </div>
            </div>

        {% endif %}


        {% for message in app.session.flashbag.get('create_personne') %}

            <div class="alert alert-success alert-dismissible fade show" role="alert">
                <strong>{{ message }}!</strong>
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
        {% endfor %}


        {% for message in app.session.flashbag.get('create_vehicule') %}

            <div class="alert alert-success alert-dismissible fade show" role="alert">
                <strong>{{ message }}!</strong>
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
        {% endfor %}



        {% for message in app.session.flashbag.get('create_organisation') %}

            <div class="alert alert-success alert-dismissible fade show" role="alert">
                <strong>{{ message }}!</strong>
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
        {% endfor %}



        <ul class="nav nav-tabs md-tabs" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
                <a class="nav-link active" id="affaire-tab" data-toggle="tab" href="#affaire" type="button" role="tab" aria-controls="todo" aria-selected="true">Affaire</a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" id="entite-tab" data-toggle="tab" href="#entite" type="button" role="tab" aria-controls="entite" aria-selected="false">Entites</a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" id="envenement-tab" data-toggle="tab" href="#envenement" type="button" role="tab" aria-controls="envenement" aria-selected="false">Evenements</a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" id="report-tab" data-toggle="tab" href="#report" type="button" role="tab" aria-controls="report" aria-selected="false">Rapports</a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" id="administration-tab" data-toggle="tab" href="#administration" type="button" role="tab" aria-controls="administration" aria-selected="false">Administration</a>
            </li>
        </ul>
        <div class="tab-content card pt-5" id="myTabContent">
            <div class="tab-pane fade show active" id="affaire" role="tabpanel" aria-labelledby="affaire-tab">
                <div class="row" style="margin-top:  1em; margin-left: 1em; width: 100% ">
                    <div class="col col-8">
                        <div class="card card-cascade">
                            <div class="view view-cascade gradient-card-header blue-gradient">

                                <h2 class="card-subtitle mb-3">Affaire</h2>

                            </div>
                            <!-- Card content -->
                            <div class="card-body card-body-cascade">
                                <div class="mb-2 ">
                                    <span class="font-weight-bold">Numero de dossier : </span>
                                    <span >{{ affaire.numeroMatricule }}</span>
                                </div>
                                <div class="mb-2">
                                    <span class="font-weight-bold">Nom : </span>
                                    <span class="text-break">{{ affaire.nom }}</span>
                                </div>

                                <div class="mb-2">
                                    <span class="font-weight-bold">Description : </span>
                                    <span class="text-break">{{ affaire.description }}</span>
                                </div>

                                <div class="mb-2">
                                    <span class="font-weight-bold">Niveau d'accreditation : </span>
                                    <span>{{ affaire.niveauAccreditation }}</span>
                                </div>

                                <div class="mb-2">
                                    <span class="font-weight-bold">Date d'ouverture : </span>
                                    <span>{{ affaire.createdAt|date('d-m-Y H:i:s') }}</span>
                                </div>

                                <div class="mb-2">
                                    <span class="font-weight-bold">Ouvert par : </span>
                                    <span class="text-uppercase">{{ affaire.createdBy.nom }}&nbsp;{{ affaire.createdBy.prenom }}</span>
                                </div>

                                <div class="mb-5">
                                    <span class="font-weight-bold">Departement en charge : </span>
                                    <span class="text-uppercase">{{ affaire.departement.nom }}</span>
                                </div>
                            </div>

                        </div>



                        <div class="mb-5">

                            <div class="card card-cascade">
                                <div class="view view-cascade gradient-card-header aqua-gradient">

                                    <h2 class="card-subtitle mb-3">Rapport initial</h2>

                                </div>
                                <!-- Card content -->
                                <div class="card-body card-body-cascade">
                                    <div>{{ affaire.resume|raw }}</div>
                                </div>

                            </div>

                        </div>


                        <div class="mb-2">


                            <div class="mb-5">

                                <div class="card card-cascade">
                                    <div class="view view-cascade gradient-card-header blue-gradient">

                                        <h2 class="card-subtitle mb-3">En charge du dossier</h2>

                                    </div>
                                    <!-- Card content -->
                                    <div class="card-body card-body-cascade">
                                        <table id="dtMaterialDesignExample" class="table text-left display" >
                                            <thead>
                                            <tr>
                                                <th class="th-sm">
                                                </th>
                                                <th class="th-sm">Nom et Prenoms
                                                </th>
                                                <th class="th-sm">Departement
                                                </th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            {% for utilisateur in affaire.affaireUtilisateurs %}
                                                {% if utilisateur.isRevoked == false %}
                                                    <tr>
                                                        <td class="text-center">
                                                            <i class="fa fa-user"></i>
                                                        </td>
                                                        <td class="text-uppercase">{{ utilisateur.utilisateur.nom }}&nbsp;{{ utilisateur.utilisateur.prenom }}</td>
                                                        <td>{{ utilisateur.utilisateur.departement.nom }}</td>
                                                    </tr>
                                                {% endif %}

                                            {% endfor %}

                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>  <!-- Tab Affaire -->


            <!-- Tab Entites -->
            <div class="tab-pane fade" id="entite" role="tabpanel" aria-labelledby="entite-tab">
                <div class="row" style="margin-top: 1em">

                   <div class="col col-12">
                       <div class="card card-cascade">
                           <div class="view view-cascade gradient-card-header blue-gradient">

                               <h2 class="card-subtitle mb-3">Entites</h2>

                           </div>
                           <!-- Card content -->
                           <div class="card-body card-body-cascade">



                               <div class="dropdown">

                                   <!--Trigger-->
                                   <a class="btn btn-outline-primary dropdown-toggle" type="button" id="dropdownMenu2" data-toggle="dropdown"
                                      aria-haspopup="true" aria-expanded="false">Ajouter une entite</a>


                                   <!--Menu-->
                                   <div class="dropdown-menu dropdown-primary">
                                       <a class="dropdown-item" href="{{ path('create_entite',{'id': affaire.id,'type':1}) }}">Personne</a>
                                       <a class="dropdown-item" href="{{ path('create_entite',{'id': affaire.id,'type':2}) }}">Vehicule</a>
                                       <a class="dropdown-item" href="{{ path('create_entite',{'id': affaire.id ,'type':3}) }}">Organisation</a>
                                   </div>
                               </div>



                               <table id="dtMaterialDesignExample" class="table text-left display" >
                                   <thead>
                                   <tr>
                                       <th class="th-sm">
                                       </th>
                                       <th class="th-sm">Nom / Prenom /Description
                                       </th>
                                       <th class="th-sm">Alias
                                       </th>
                                       <th class="th-sm">Description
                                       </th>
                                       <th class="th-sm">Role
                                       </th>
                                       <th class="th-sm">
                                           Action
                                       </th>
                                   </tr>
                                   </thead>
                                   <tbody>
                                   {% for entite in affaire.entites %}
                                       <tr>
                                           <td class="text-center">
                                               <img src="{{ asset('/upload/') }}{{ entite.mainPicture }}" alt="thumbnail" class="img-thumbnail"
                                                    style="width: 8em;height: 8em">
                                           </td>
                                           <td class="text-uppercase">{{ entite.description }}&nbsp;{{ entite.description2 }}</td>

                                           <td class="text-uppercase">
                                               {% if entite.aliases is defined   %}
                                                   {% for alias in entite.aliases %}
                                                       {{ alias.alias }}
                                                   {% endfor %}
                                               {% endif %}
                                           </td>

                                           <td class="text-reset  ">
                                               {{ entite.resume | raw }}
                                           </td>


                                           <td>
                                               {% if entite.role == constant('ROLE_SUSPECT', entite)  %}
                                                   <span class="font-weight-bold">SUSPECT</span>
                                               {% endif %}

                                               {% if entite.role == constant('ROLE_INTEREST', entite)  %}
                                                   <span class="font-weight-bold">PERSONNE D'INTERET</span>
                                               {% endif %}

                                               {% if entite.role == constant('ROLE_VICTIME', entite)  %}
                                                   <span class="font-weight-bold">VICTIME</span>
                                               {% endif %}

                                               {% if entite.role == constant('ROLE_SOURCE', entite)  %}
                                                   <span class="font-weight-bold">SOURCE</span>
                                               {% endif %}

                                           </td>

                                           <td>

                                               <div class="d-flex align-items-center">
                                                   <a href="{{ path('affaire_details', {id: affaire.id, entite_id: entite.id }) }}" class="btn-floating btn-sm btn-primary">
                                                       <i class="fa fa-eye"></i>
                                                   </a>
                                                   <a class="btn-floating btn-sm btn-deep-purple">
                                                       <i class="fa fa-pen"></i>
                                                   </a>
                                                   <a class="btn-floating btn-sm btn-danger">
                                                       <i class="fa fa-trash"></i>
                                                   </a>
                                               </div>
                                           </td>

                                       </tr>
                                   {% endfor %}

                                   </tbody>
                               </table>
                           </div>
                       </div>
                   </div>

                </div>
            </div>


            <div class="tab-pane fade" id="envenement" role="tabpanel" aria-labelledby="envenement-tab">
                <div class="row" style="margin-top: 1em">
                </div>
            </div>
            <div class="tab-pane fade" id="report" role="tabpanel" aria-labelledby="report-tab">
                <div class="row" style="margin-top: 1em">
                </div>
            </div>
            <div class="tab-pane fade" id="administration" role="tabpanel" aria-labelledby="administration-tab">
                <div class="row" style="margin-top: 1em">
                </div>
            </div>
        </div>
    </div>



    {% block botton_javascripts %}
        <script>

            $(document).ready(function() {

                {% if entite is not null %}

                $('#entiteModal').modal('show');

                {% endif %}

                $('#entiteModal').on('hidden.bs.modal', function (event) {
                    window.location = "{{ path('affaire_details', {id: affaire.id }) }}"
                })

            });


        </script>
    {% endblock %}



{% endblock %}
