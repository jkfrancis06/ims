{% extends 'nav-courrier.html.twig' %}

{% block title %}Courriers  {% endblock %}


{% block javascripts %}


{% endblock %}

 {% block stylesheets %}

     <link rel="stylesheet" href="{{ asset('/assets/css/datatables/buttons.dataTables.css') }}" />
     <link rel="stylesheet" href="{{ asset('/assets/css/datatables/buttons.bootstrap5.css') }}" />
     <link rel="stylesheet" href="{{ asset('/assets/css/datatables/searchPanes.bootstrap5.css') }}" />
     <link rel="stylesheet" href="{{ asset('/assets/css/datatables/select.dataTables.css') }}" />

     <style>
         .dt-buttons{
             margin-bottom: 1em!important;
             margin-left: 0.5em!important;
         }
         #tab-content{
             display: none;
         }
         #loader{
             display: block;
         }
         #loading {
             background: url('{{ asset('/assets/img/loader.gif') }}') no-repeat center center;
             position: absolute;
             top: 0;
             left: 0;
             height: 100%;
             width: 100%;
             z-index: 9999999;
         }
     </style>
 {% endblock %}


{% block content %}



    <div class="col col-12 mt-5">

        <table id="courriers" class="table table-striped table-bordered table-responsive">
            <thead>
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">Date</th>
                    <th scope="col">Flux</th>
                    <th scope="col">Origine</th>
                    <th scope="col">Destination</th>
                    <th scope="col">Type</th>
                    <th scope="col">Sujet</th>
                    <th scope="col">Commentaires</th>
                    <th scope="col">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for courrier in courriers %}
                    <tr>
                        <td>{{ courrier.referenceInterne }}</td>
                        <td>{{ courrier.datecourrier|date('d-m-Y') }}</td>
                        <td>
                            {% if constant('FLUX_ENTRANT', courrier) == courrier.flux %}
                                Entrant
                            {% else %}
                                Sortant
                            {% endif %}
                        </td>
                        <td>{{ courrier.origine | country('fr') }}</td>
                        <td>{{ courrier.destination | country('fr') }}</td>
                        <td>
                            {% if constant('COURRIER_OFF', courrier) == courrier.type %}
                                Courrier Officiel
                            {% endif %}

                            {% if constant('COURRIER_NOTE', courrier) == courrier.type %}
                                Note de renseignement
                            {% endif %}

                            {% if constant('COURRIER_FORUM', courrier) == courrier.type %}
                                Forum
                            {% endif %}
                        </td>
                        <td>{{ courrier.sujet }}</td>
                        <td>{{ courrier.commentaire|raw }}</td>
                        <td>
                            {% for pieces in courrier.piecejointe %}
                                <a class="btn btn-sm btn-blue mt-1" download href="{{ path('download', {'name': pieces.filename}) }}">
                                    <i class="fa fa-download"></i> {{ pieces.filename }}
                                </a>
                            {% endfor %}
                        </td>

                    </tr>
                {% endfor %}

            </tbody>
        </table>

    </div>





    {% block botton_javascripts %}




        <script>
            $(document).ready(function () {

                $("#courriers").dataTable().fnDestroy();


                var table = $('#courriers').DataTable({
                    searchPanes: {
                        threshold: 0.4
                    },
                    dom: 'Plfrtip',
                    columnDefs: [
                        {
                            searchPanes: {
                                threshold: 1
                            },
                            targets: [0,2]
                        }
                    ],
                    buttons: [
                        'excel', {
                            extend: 'pdfHtml5',
                            orientation: 'landscape',
                            pageSize: 'LEGAL'
                        }
                    ],
                    "order": [[ 1, "asc" ]],
                    "language": {
                        "sProcessing":     "Traitement en cours...",
                        "sSearch":         "Rechercher&nbsp;:",
                        "sLengthMenu":     "Afficher _MENU_ &eacute;l&eacute;ments",
                        "sInfo":           "Affichage de l'&eacute;lement _START_ &agrave; _END_ sur _TOTAL_ &eacute;l&eacute;ments",
                        "sInfoEmpty":      "Affichage de l'&eacute;lement 0 &agrave; 0 sur 0 &eacute;l&eacute;ments",
                        "sInfoFiltered":   "(filtr&eacute; de _MAX_ &eacute;l&eacute;ments au total)",
                        "sInfoPostFix":    "",
                        "sLoadingRecords": "Chargement en cours...",
                        "sZeroRecords":    "Aucun &eacute;l&eacute;ment &agrave; afficher",
                        "sEmptyTable":     "Aucune donn&eacute;e disponible dans le tableau",
                        "oPaginate": {
                            "sFirst":      "Premier",
                            "sPrevious":   "Pr&eacute;c&eacute;dent",
                            "sNext":       "Suivant",
                            "sLast":       "Dernier"
                        },
                        "oAria": {
                            "sSortAscending":  ": activer pour trier la colonne par ordre croissant",
                            "sSortDescending": ": activer pour trier la colonne par ordre d&eacute;croissant"
                        }
                    }
                });



                /*var container = $('<div/>').insertBefore(table.table().container());



                var chart = Highcharts.chart(container[0], {
                    chart: {
                        type: 'pie',
                    },
                    title: {
                        text: 'Courriers par pays',
                    },
                    series: [
                        {
                            data: chartData(table),
                        },
                    ],
                });

                table.on('draw', function () {
                    console.log('ok')

                    chart.series[0].setData(chartData(table));
                }); */


            })


            /*function chartData(table) {

                var counts = {};

                // Count the number of entries for each position
                table
                    .column(3, { search: 'applied' })
                    .data()
                    .each(function (val) {
                        if (counts[val]) {
                            counts[val] += 1;
                        } else {
                            counts[val] = 1;
                        }
                    });

                // And map it to the format highcharts uses
                return $.map(counts, function (val, key) {
                    return {
                        name: key,
                        y: val,
                    };
                });
            }*/
        </script>

    {% endblock %}




{% endblock %}
